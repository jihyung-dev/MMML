<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>가계부 대시보드</title>

    <!-- Highcharts -->
    <script src="https://code.highcharts.com/highcharts.js"></script>
    <script src="https://code.highcharts.com/modules/exporting.js"></script>
    <script src="https://code.highcharts.com/modules/export-data.js"></script>
    <script src="https://code.highcharts.com/modules/accessibility.js"></script>

    <!-- FullCalendar -->
    <script src='https://cdn.jsdelivr.net/npm/fullcalendar@6.1.10/index.global.min.js'></script>

    <!-- CSS 및 JS 로드 -->
    <link rel="stylesheet" href="/css/ledger.css">
    <script src="/js/household/ledger.js"></script>
</head>
<body>

<!-- 상단 헤더 (네비게이션 + 요약) -->
<div class="header-container">
    <!-- 1. 월 이동 네비게이션 (기존 디자인 유지) -->
    <div id="monthNav" class="month-nav">
        <button id="prevBtn" class="neo-btn" onclick="prevMonth()">&#9664;</button>
        <span id="currentMonthLabel" class="neo-label">2025년 10월</span>
        <button id="nextBtn" class="neo-btn" onclick="nextMonth()">&#9654;</button>
    </div>

    <!-- 2. 월 소계 -->
    <div class="summary-info">
        <div class="amount-group">
            <h2></h2>
            <h3></h3>
        </div>
    </div>
</div>

<!-- 메인 대시보드 (차트 + 캘린더 가로 배치) -->
<div class="dashboard-container">
    <!-- 왼쪽: 카테고리 차트 -->
    <div class="chart-wrapper">
        <div id="categoryChart" style="width: 100%; height: 100%;"></div>
    </div>

    <!-- 오른쪽: 캘린더 -->
    <div class="calendar-wrapper">
        <div id="calendar"></div>
    </div>
</div>

<!-- 하단: 일별 차트 (기존 유지) -->
<div id="dailyChart" style="width: 100%; height: 400px; max-width: 1200px; margin: 30px auto;"></div>

<!-- 모달 (기존 유지) -->
<div id="chartModal" class="modal-overlay">
    <div class="modal-content">
        <span class="close-btn" onclick="closeModal()">&times;</span>
        <h2 id="modalTitle">상세 내역</h2>
        <div id="modalBody">내용 로딩 중...</div>
    </div>
</div>

<!-- 스크립트: 캘린더 초기화 -->
<script>
    document.addEventListener('DOMContentLoaded', function() {
        var calendarEl = document.getElementById('calendar');

        // FullCalendar 설정
        var calendar = new FullCalendar.Calendar(calendarEl, {
            initialView: 'dayGridMonth',
            locale: 'ko',
            initialDate: '2025-10-01', // 기준일 설정
            contentHeight: 'auto',

            // 날짜 표시 형식 ('일' 제거)
            dayCellContent: function(arg) {
                return { html: arg.dayNumberText.replace('일', '') };
            },

            // 이벤트 데이터 (수입/지출)
            events: [
                { title: '-48,640', start: '2025-10-01', classNames: ['expense-amount'] },
                { title: '-19,000', start: '2025-10-02', classNames: ['expense-amount'] },
                { title: '-11,200', start: '2025-10-03', classNames: ['expense-amount'] },
                { title: '-120,850', start: '2025-10-10', classNames: ['expense-amount'] },
                { title: '+19,310', start: '2025-10-10', classNames: ['income-amount'] },
                { title: '-365,760', start: '2025-10-15', classNames: ['expense-amount'] },
            ],

            // 날짜 클릭 시 모달 열기
            dateClick: function(info) {
                document.getElementById('modalTitle').innerText = info.dateStr + " 상세 내역";
                document.getElementById('modalBody').innerHTML = "<p>데이터를 불러오는 중입니다...</p>";
                document.getElementById('chartModal').style.display = 'flex'; // flex로 열어야 중앙 정렬됨
            }
        });

        calendar.render();

        // 상단 버튼 연동 (기존 함수와 함께 캘린더 이동)
        document.getElementById('prevBtn').addEventListener('click', function() {
            calendar.prev();
            updateCalendarLabel();
        });

        document.getElementById('nextBtn').addEventListener('click', function() {
            calendar.next();
            updateCalendarLabel();
        });

        function updateCalendarLabel() {
            var date = calendar.getDate();
            var year = date.getFullYear();
            var month = date.getMonth() + 1;
            document.getElementById('currentMonthLabel').innerText = year + "년 " + month + "월";
        }
    });

    // 모달 닫기
    function closeModal() {
        document.getElementById('chartModal').style.display = 'none';
    }
</script>
</body>
</html>