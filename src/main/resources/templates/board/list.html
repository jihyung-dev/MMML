<!DOCTYPE html>
<html lang="ko"
      xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{layouts/default_layout}">
<head>
    <title>게시판 목록</title>

    <!-- 2. 페이지별 전용 CSS 영역 -->
    <th:block layout:fragment="css">
        <link rel="stylesheet" th:href="@{/css/board.css}">
        <style>
            .board-container { max-width: 1000px; margin: 0 auto; }
            table { width: 100%; border-collapse: collapse; margin-top: 20px; }
            th, td { padding: 12px; border-bottom: 1px solid #ddd; text-align: center; }
            th { background-color: #f8f9fa; }
        </style>
    </th:block>
</head>
<body>

<div layout:fragment="content">
    <div class="container mt-4 board-container">

        <!-- ===========================
               상단 헤더 (이미지 대신)
        ============================= -->
        <div class="board-header d-flex align-items-center mb-4">
            <div class="board-header-icon">
                <span class="board-header-bar bar-top"></span>
                <span class="board-header-bar bar1"></span>
                <span class="board-header-bar bar2"></span>
                <span class="board-header-bar bar3"></span>
            </div>

            <div class="ms-3">
                <h1 class="board-header-title mb-1">게시판</h1>
                <p class="board-header-subtitle mb-0">
                    자유게시판, 핫딜 팁, 가계부 팁 등을 공유하는 게시판입니다.
                </p>
            </div>
        </div>

        <!-- ===========================
               글쓰기 버튼 (기존 그대로)
        ============================= -->
        <div class="d-flex justify-content-end mb-3">
            <th:block th:if="${session.loginUser != null}">
                <a class="btn btn-sm primary-btn" href="/board/write">글쓰기</a>
            </th:block>

            <th:block th:if="${session.loginUser == null}">
                <button class="btn btn-sm btn-secondary"
                        onclick="alert('로그인 후 이용 가능합니다.');">
                    글쓰기
                </button>
            </th:block>
        </div>

        <!-- ===========================
               카테고리 바로가기 버튼
        ============================= -->
        <div class="d-flex gap-2 mb-3">
            <!-- 전체 -->
            <a th:href="@{/board(keyword=${keyword})}"
               class="btn btn-sm"
               th:classappend="${selectedCategory} == null ? ' btn-primary' : ' btn-outline-primary'">
                전체
            </a>

            <!-- 자유게시판 -->
            <a th:href="@{/board(category='자유게시판', keyword=${keyword})}"
               class="btn btn-sm"
               th:classappend="${selectedCategory} == '자유게시판' ? ' btn-primary' : ' btn-outline-primary'">
                자유게시판
            </a>

            <!-- 핫딜 팁 -->
            <a th:href="@{/board(category='핫딜 팁', keyword=${keyword})}"
               class="btn btn-sm"
               th:classappend="${selectedCategory} == '핫딜 팁' ? ' btn-primary' : ' btn-outline-primary'">
                핫딜 팁
            </a>

            <!-- 가계부 팁 -->
            <a th:href="@{/board(category='가계부 팁', keyword=${keyword})}"
               class="btn btn-sm"
               th:classappend="${selectedCategory} == '가계부 팁' ? ' btn-primary' : ' btn-outline-primary'">
                가계부 팁
            </a>
        </div>

        <!-- ===========================
                    게시글 목록
        ============================= -->
        <div class="table-responsive">
            <table class="table table-hover">
                <thead class="table-light">
                <tr>
                    <th style="width: 10%">ID</th>
                    <th style="width: 15%">카테고리</th>
                    <th style="width: 40%">제목</th>
                    <th style="width: 15%">작성자</th>
                    <th style="width: 10%">작성일</th>
                    <th style="width: 10%">조회수</th>
                </tr>
                </thead>

                <tbody>
                <tr th:each="p : ${posts}">
                    <td th:text="${p.id}"></td>
                    <td th:text="${p.category}"></td>

                    <td class="text-start">
                        <a th:href="@{'/board/' + ${p.id}}"
                           th:text="${p.postTitle}" class="text-decoration-none text-dark fw-bold"></a>
                    </td>

                    <td th:text="${p.writer != null ? p.writer.memberNickname : '작성자 없음'}"></td>

                    <td th:text="${#temporals.format(p.createdAt, 'MM-dd')}"></td>

                    <td th:text="${p.viewCnt}"></td>
                </tr>

                <tr th:if="${posts.isEmpty()}">
                    <td colspan="6" class="text-center py-5">등록된 게시글이 없습니다.</td>
                </tr>
                </tbody>
            </table>
        </div>

        <br/>

        <!-- ===========================
                    검색창
        ============================= -->
        <form class="board-search-box d-flex justify-content-center gap-2 mb-4"
              th:action="@{/board}" method="get">

            <!-- 카테고리 유지용 hidden -->
            <input type="hidden" name="category" th:value="${selectedCategory}"/>

            <input type="text" name="keyword" class="form-control w-50"
                   th:value="${keyword}"
                   placeholder="검색어를 입력하세요 (제목+내용)">

            <button type="submit" class="btn btn-outline-dark">검색</button>
        </form>

        <br/>

        <!-- ===========================
                   페이징 (≪ 1 2 3 ≫)
        ============================= -->
        <div th:with="page=${posts.number}, last=${posts.totalPages}, size=${posts.size}"
             class="my-4 d-flex justify-content-center">

            <nav>
                <ul class="pagination">

                    <!-- 맨 처음 페이지로 (≪) -->
                    <li class="page-item"
                        th:classappend="${page == 0} ? ' disabled'">
                        <a class="page-link"
                           th:href="@{/board(page=0, size=${size}, keyword=${keyword}, category=${selectedCategory})}">
                            ≪
                        </a>
                    </li>

                    <!-- 페이지 번호 목록 -->
                    <li class="page-item"
                        th:each="i : ${#numbers.sequence(1, last)}"
                        th:classappend="${(i - 1) == page} ? ' active'">
                        <a class="page-link"
                           th:href="@{/board(page=${i - 1}, size=${size}, keyword=${keyword}, category=${selectedCategory})}"
                           th:text="${i}">
                        </a>
                    </li>

                    <!-- 맨 마지막 페이지로 (≫) -->
                    <li class="page-item"
                        th:classappend="${page == (last - 1)} ? ' disabled'">
                        <a class="page-link"
                           th:href="@{/board(page=${last - 1}, size=${size}, keyword=${keyword}, category=${selectedCategory})}">
                            ≫
                        </a>
                    </li>

                </ul>
            </nav>
        </div>

    </div>
</div>

</body>
</html>
