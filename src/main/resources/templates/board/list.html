<!DOCTYPE html>
<html lang="ko"
      xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{layouts/default_layout}"> <!-- ##1. 공통 레이아웃 상속 선언 -->
<head>
    <title>게시판 목록</title>

    <!-- 2. 페이지별 전용 CSS 영역 -->
    <th:block layout:fragment="css">
        <link rel="stylesheet" th:href="@{/css/list.css}">
        <style>
            /* 추가 스타일 (필요시) */
            .board-container { max-width: 1000px; margin: 0 auto; }
            table { width: 100%; border-collapse: collapse; margin-top: 20px; }
            th, td { padding: 12px; border-bottom: 1px solid #ddd; text-align: center; }
            th { background-color: #f8f9fa; }
            /* ... list.css의 내용이 있다면 여기 스타일은 제거 가능 ... */
        </style>
    </th:block>
</head>
<body>

<!-- 상단 로고 & 로그인 정보 -->
<div layout:fragment="content">
    <div class="container mt-4 board-container"> <!-- Bootstrap container로 여백 확보 -->

    <a href="/" class="nav-brand">내돈내삶</a>

    <div class="nav-right">
        <div th:if="${session.loginUser != null}" class="nav-user-info">
            <span th:text="${session.loginUser.memberNickname + '님 환영합니다!'}"></span>
            &nbsp; | &nbsp;
            <a href="/logout" class="nav-logout-btn">로그아웃</a>
        </div>

        <div th:if="${session.loginUser == null}" class="nav-user-info">
            <a href="/login">로그인</a>
        </div>
    </div>

<!-- 상단 배너 이미지 -->
<img th:src="@{/img/게시판 이미지.jpg}"
     alt="게시판 이미지"
     style="width:100%; max-height:150px; object-fit:cover; margin-bottom:20px; border-radius: 5px">

        <h2 class="fw-bold mb-4">가계부 게시판 목록</h2>

        <!-- ===========================
               글쓰기 버튼 (로그인만)
        ============================= -->
        <div class="d-flex justify-content-end mb-3">
            <th:block th:if="${session.loginUser != null}">
                <a class="btn primary-btn" href="/board/write">글쓰기</a>
            </th:block>

            <!-- 비로그인 상태 → 안내 버튼 -->
            <th:block th:if="${session.loginUser == null}">
                <button class="btn btn-secondary"
                        onclick="alert('로그인 후 이용 가능합니다.');">
                    글쓰기
                </button>
            </th:block>
        </div>

        <!-- ===========================
                    게시글 목록
        ============================= -->
        <div class="table-responsive">
            <table class="table table-hover">
                <thead class="table-light">
                <tr>
                    <th style="width: 10%">ID</th>
                    <th style="width: 15%">카테고리</th>
                    <th style="width: 40%">제목</th>
                    <th style="width: 15%">작성자</th>
                    <th style="width: 10%">작성일</th>
                    <th style="width: 10%">조회수</th>
                </tr>
                </thead>

                <tbody>
                <tr th:each="p : ${posts}">
                    <td th:text="${p.id}"></td>
                    <td th:text="${p.category}"></td>

                    <td class="text-start">
                        <a th:href="@{'/board/' + ${p.id}}"
                           th:text="${p.postTitle}" class="text-decoration-none text-dark fw-bold"></a>
                    </td>

                    <td th:text="${p.writer != null ? p.writer.memberNickname : '작성자 없음'}"></td>

                    <!-- 날짜 포맷팅 (오늘 날짜면 시간만, 아니면 날짜 표시 등) -->
                    <td th:text="${#temporals.format(p.createdAt, 'MM-dd')}"></td>

                    <td th:text="${p.viewCnt}"></td>
                </tr>
                <!-- 게시글 없을 때 처리 -->
                <tr th:if="${posts.isEmpty()}">
                    <td colspan="6" class="text-center py-5">등록된 게시글이 없습니다.</td>
                </tr>
                </tbody>
            </table>
        </div>

        <br/>

        <!-- ===========================
                    검색창
        ============================= -->
        <form class="board-search-box d-flex justify-content-center gap-2 mb-4"
              th:action="@{/board/list.do}" method="get">

            <input type="text" name="keyword" class="form-control w-50"
                   th:value="${keyword}"
                   placeholder="검색어를 입력하세요 (제목+내용)">

            <button type="submit" class="btn btn-outline-dark">검색</button>
        </form>

<br/>

<!-- 페이징 -->
<!-- ===========================
           페이징 (≪ 1 2 3 ≫)
============================= -->
<div th:with="page=${posts.number}, last=${posts.totalPages}, size=${posts.size}"
     class="my-4 d-flex justify-content-center">

    <nav>
        <ul class="pagination">

            <!-- 맨 처음 페이지로 (≪) -->
            <li class="page-item"
                th:classappend="${page == 0} ? ' disabled'">
                <a class="page-link"
                   th:href="@{/board(page=0, size=${size}, keyword=${keyword})}">
                    ≪
                </a>
            </li>

            <!-- 페이지 번호 목록 -->
            <li class="page-item"
                th:each="i : ${#numbers.sequence(1, last)}"
                th:classappend="${(i - 1) == page} ? ' active'">
                <a class="page-link"
                   th:href="@{/board(page=${i - 1}, size=${size}, keyword=${keyword})}"
                   th:text="${i}">
                </a>
            </li>

            <!-- 맨 마지막 페이지로 (≫) -->
            <li class="page-item"
                th:classappend="${page == (last - 1)} ? ' disabled'">
                <a class="page-link"
                   th:href="@{/board(page=${last - 1}, size=${size}, keyword=${keyword})}">
                    ≫
                </a>
            </li>

        </ul>
    </nav>
</div>

</body>
</html>