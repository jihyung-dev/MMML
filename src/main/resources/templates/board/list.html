<!DOCTYPE html>
<html lang="ko"
      xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{layouts/default_layout}"> <!-- ##1. 공통 레이아웃 상속 선언 -->
<head>
    <title>게시판 목록</title>

    <!-- 2. 페이지별 전용 CSS 영역 -->
    <th:block layout:fragment="css">
        <link rel="stylesheet" th:href="@{/css/list.css}">
        <style>
            /* 추가 스타일 (필요시) */
            .board-container { max-width: 1000px; margin: 0 auto; }
            table { width: 100%; border-collapse: collapse; margin-top: 20px; }
            th, td { padding: 12px; border-bottom: 1px solid #ddd; text-align: center; }
            th { background-color: #f8f9fa; }
            /* ... list.css의 내용이 있다면 여기 스타일은 제거 가능 ... */
        </style>
    </th:block>
</head>
<body>

<!-- 3. 실제 본문 내용 영역 -->
<div layout:fragment="content">
    <div class="container mt-4 board-container"> <!-- Bootstrap container로 여백 확보 -->

        <!-- 상단 이미지 -->
        <img th:src="@{/img/board_banner.jpg}"
             alt="게시판 이미지"
             class="img-fluid rounded mb-4"
             style="width:100%; max-height:200px; object-fit:cover;">

        <h2 class="fw-bold mb-4">가계부 게시판 목록</h2>

        <!-- ===========================
               글쓰기 버튼 (로그인만)
        ============================= -->
        <div class="d-flex justify-content-end mb-3">
            <th:block th:if="${session.loginUser != null}">
                <a class="btn primary-btn" href="/board/write">글쓰기</a>
            </th:block>

            <!-- 비로그인 상태 → 안내 버튼 -->
            <th:block th:if="${session.loginUser == null}">
                <button class="btn btn-secondary"
                        onclick="alert('로그인 후 이용 가능합니다.');">
                    글쓰기
                </button>
            </th:block>
        </div>

        <!-- ===========================
                    게시글 목록
        ============================= -->
        <div class="table-responsive">
            <table class="table table-hover">
                <thead class="table-light">
                <tr>
                    <th style="width: 10%">ID</th>
                    <th style="width: 15%">카테고리</th>
                    <th style="width: 40%">제목</th>
                    <th style="width: 15%">작성자</th>
                    <th style="width: 10%">작성일</th>
                    <th style="width: 10%">조회수</th>
                </tr>
                </thead>

                <tbody>
                <tr th:each="p : ${posts}">
                    <td th:text="${p.id}"></td>
                    <td th:text="${p.category}"></td>

                    <td class="text-start">
                        <a th:href="@{'/board/' + ${p.id}}"
                           th:text="${p.postTitle}" class="text-decoration-none text-dark fw-bold"></a>
                    </td>

                    <td th:text="${p.writer != null ? p.writer.memberNickname : '작성자 없음'}"></td>

                    <!-- 날짜 포맷팅 (오늘 날짜면 시간만, 아니면 날짜 표시 등) -->
                    <td th:text="${#temporals.format(p.createdAt, 'MM-dd')}"></td>

                    <td th:text="${p.viewCnt}"></td>
                </tr>
                <!-- 게시글 없을 때 처리 -->
                <tr th:if="${posts.isEmpty()}">
                    <td colspan="6" class="text-center py-5">등록된 게시글이 없습니다.</td>
                </tr>
                </tbody>
            </table>
        </div>

        <br/>

        <!-- ===========================
                    검색창
        ============================= -->
        <form class="board-search-box d-flex justify-content-center gap-2 mb-4"
              th:action="@{/board/list.do}" method="get">

            <input type="text" name="keyword" class="form-control w-50"
                   th:value="${keyword}"
                   placeholder="검색어를 입력하세요 (제목+내용)">

            <button type="submit" class="btn btn-outline-dark">검색</button>
        </form>

        <!-- ===========================
                   페이징
        ============================= -->
        <nav aria-label="Page navigation" th:if="${posts.totalPages > 0}">
            <ul class="pagination justify-content-center">
                <!-- 이전 페이지 -->
                <li class="page-item" th:classappend="${!posts.hasPrevious()} ? 'disabled'">
                    <a class="page-link" th:href="@{/board/list.do(page=${posts.number - 1}, keyword=${keyword})}">이전</a>
                </li>

                <!-- 페이지 번호 (현재 페이지 주변만 표시하는 로직은 추가 구현 필요, 여기선 단순화) -->
                <li class="page-item disabled">
                        <span class="page-link">
                            <span th:text="${posts.number + 1}"></span> / <span th:text="${posts.totalPages}"></span>
                        </span>
                </li>

                <!-- 다음 페이지 -->
                <li class="page-item" th:classappend="${!posts.hasNext()} ? 'disabled'">
                    <a class="page-link" th:href="@{/board/list.do(page=${posts.number + 1}, keyword=${keyword})}">다음</a>
                </li>
            </ul>
        </nav>

    </div> <!-- container end -->
</div> <!-- layout:fragment="content" end -->

</body>
</html>