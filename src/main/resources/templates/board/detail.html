<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <title th:text="'게시글 - ' + ${post.postTitle}"></title>
</head>
<body>
<div>
    ❤️ 좋아요 수: <span th:text="${post.boardLikes.size()}"></span>
</div>

<!-- 좋아요 버튼 -->
<form th:action="@{/like/add}" method="post" style="display:inline;">
    <input type="hidden" name="id" value="77777"> <!-- 직접 PK 입력 -->
    <input type="hidden" name="postId" th:value="${post.id}">
    <input type="text" name="memberId" placeholder="작성자ID"> <!-- 테스트용 -->
    <button type="submit">좋아요</button>
</form>

<!-- 좋아요 취소 버튼 -->
<form th:action="@{/like/remove}" method="post" style="display:inline;">
    <input type="hidden" name="postId" th:value="${post.id}">
    <input type="text" name="memberId" placeholder="작성자ID">
    <button type="submit">좋아요 취소</button>
</form>

<hr>

<h2 th:text="${post.postTitle}"></h2>

<p><strong>카테고리:</strong> <span th:text="${post.category}"></span></p>
<p><strong>작성자:</strong> <span th:text="${post.writer.memberNickname}"></span></p>
<p><strong>작성일:</strong> <span th:text="${post.createdAt}"></span></p>
<p><strong>조회수:</strong> <span th:text="${post.viewCnt}"></span></p>

<hr/>

<div th:text="${post.postContent}"></div>

<hr/>

<a th:href="@{'/board/' + ${post.id} + '/edit'}">수정</a>
&nbsp;

<form th:action="@{'/board/' + ${post.id} + '/delete'}"
      method="post" style="display:inline;">
    <button type="submit">삭제</button>
</form>

<br/><br/>

<a href="/board">목록으로</a>

<hr>

<h3>댓글</h3>

<div th:each="c : ${post.boardComments}">
    <!-- 들여쓰기: 대댓글이면 margin 적용 -->
    <div th:style="${c.parentComment != null} ? 'margin-left: 30px;' : ''">

        <!-- 작성자 & 날짜 -->
        <b th:text="${c.writer.memberNickname}">작성자</b>
        <span th:text="${#temporals.format(c.createdAt, 'yyyy-MM-dd HH:mm')}"></span>
        <br>

        <!-- 댓글 내용 -->
        <span th:text="${c.commentContent}"></span>

        <!-- 삭제 버튼 -->
        <form th:action="@{'/comment/' + ${c.id} + '/delete'}"
              method="post" style="display:inline;">
            <input type="hidden" name="postId" th:value="${post.id}">
            <button type="submit" style="margin-left:10px;">삭제</button>
        </form>

        <!-- 대댓글 작성 -->
        <details style="margin-top: 5px;">
            <summary>답글 달기</summary>

            <form th:action="@{/comment/write}" method="post" style="margin-left: 20px;">
                <input type="hidden" name="id" value="99999"> <!-- PK 직접 입력(테스트용) -->
                <input type="hidden" name="postId" th:value="${post.id}">
                <input type="hidden" name="parentId" th:value="${c.id}">

                <input type="text" name="writerId" placeholder="작성자 ID">
                <br>
                <textarea name="content" placeholder="답글 내용" required></textarea>
                <br>
                <button type="submit">등록</button>
            </form>
        </details>
    </div>

    <hr>
</div>

<!--댓글 작성 폼-->
<h4>댓글 작성</h4>

<form th:action="@{/comment/write}" method="post">
    <input type="hidden" name="id" value="99998">
    <input type="hidden" name="postId" th:value="${post.id}">

    <input type="text" name="writerId" placeholder="작성자 ID" required>
    <br>
    <textarea name="content" placeholder="댓글 내용" required></textarea>
    <br>
    <button type="submit">등록하기</button>
</form>


</body>
</html>