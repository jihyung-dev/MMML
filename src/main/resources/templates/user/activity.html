<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{layouts/my_layout}"
      th:with="title='내 활동'">

<head>
    <th:block layout:fragment="css">
        <link rel="stylesheet" href="/css/mypage.css">
    </th:block>
</head>

<body>
<div layout:fragment="content">

    <div class="form-container space-y-10">

        <section>
            <div class="section-header">
                <h2 class="section-title">📝 내가 쓴 글</h2>
                <a href="javascript:void(0)" onclick="loadPosts(0)" class="more-link">더보기 ></a>
            </div>

            <div id="post-list-container">
                <ul th:if="${myPostPage.content.size() > 0}">
                    <li th:each="post, stat : ${myPostPage.content}" th:if="${stat.index < 3}" class="activity-item">
                        <a th:href="@{/board/{id}(id=${post.id})}" class="item-title">
                            [[${post.postTitle}]]
                        </a>
                        <span class="item-date">작성일: [[${#temporals.format(post.createdAt, 'yyyy-MM-dd')}]]</span>
                    </li>
                </ul>
                <div th:if="${myPostPage.content.size() == 0}" class="text-center py-4 text-gray-400 text-sm">
                    작성한 게시글이 없습니다.
                </div>
            </div>
        </section>

        <section>
            <div class="section-header">
                <h2 class="section-title">💬 내가 쓴 댓글</h2>
                <a href="javascript:void(0)" onclick="loadComments(0)" class="more-link">더보기 ></a>
            </div>

            <div id="comment-list-container">
                <ul th:if="${myCommentPage.totalElements > 0}">
                    <li th:each="comment, stat : ${myCommentPage}" th:if="${stat.index < 3}" class="activity-item">
                        <a th:href="@{/board/{id}(id=${comment.post.id})}" class="block">
                            <span class="item-title" th:text="${comment.commentContent}">댓글 내용</span>
                            <div class="text-xs text-gray-500 bg-gray-50 p-1.5 rounded inline-block mb-1">
                                원문: <span th:text="${comment.post.postTitle}">제목</span>
                            </div>
                            <div class="item-date" th:text="${#temporals.format(comment.createdAt, 'yyyy-MM-dd')}">날짜</div>
                        </a>
                    </li>
                </ul>
                <div th:if="${myCommentPage.totalElements == 0}" class="text-center py-4 text-gray-400 text-sm">
                    작성한 댓글이 없습니다.
                </div>
            </div>
        </section>

        <section>
            <div class="section-header">
                <h2 class="section-title">❤️ 좋아요 누른 게시글</h2>
                <a href="javascript:void(0)" onclick="loadLiked(0)" class="more-link">더보기 ></a>
            </div>

            <div id="liked-list-container">
                <ul th:if="${likedPostPage.content.size() > 0}">
                    <li th:each="post, stat : ${likedPostPage.content}" th:if="${stat.index < 3}" class="activity-item">
                        <a th:href="@{/board/{id}(id=${post.id})}" class="item-title">
                            [[${post.postTitle}]]
                        </a>
                        <span class="item-date">작성일: [[${#temporals.format(post.createdAt, 'yyyy-MM-dd')}]]</span>
                    </li>
                </ul>
                <div th:if="${likedPostPage.content.size() == 0}" class="text-center py-4 text-gray-400 text-sm">
                    좋아요한 게시글이 없습니다.
                </div>
            </div>
        </section>

        <section>
            <div class="section-header border-0 pb-0">
                <h2 class="section-title">🛍️ 찜한 핫딜</h2>
                <a th:href="@{/mypage/wishlist}" class="more-link">더보기 ></a>
            </div>

            <div th:if="${myWishPage == null or myWishPage.content.size() == 0}" class="text-center py-4 text-gray-400 text-sm">
                찜한 핫딜 상품이 없습니다.
            </div>

            <div class="row g-3 mt-2" th:if="${myWishPage != null and myWishPage.content.size() > 0}">
                <div class="col-6 col-md-4 col-lg-3" th:each="wish : ${myWishPage.content}">
                    <div class="card h-100 shadow-sm hotdeal-card overflow-hidden">
                        <a th:href="@{/hotdeal/{id}(id=${wish.item.id})}" style="text-decoration: none; color: inherit;">
                            <div class="overflow-hidden bg-gray-100 relative" style="height: 140px;">
                                <img th:src="${wish.item.itemImageUrl != null ? wish.item.itemImageUrl : '/img/no-image.png'}"
                                     class="w-100 h-100"
                                     alt="상품 이미지"
                                     style="object-fit: cover;"
                                     onerror="this.src='/img/no-image.png'"/>
                            </div>

                            <div class="card-body p-2 bg-gray-50/50">
                                <h5 class="card-title text-truncate mb-1 text-sm font-bold text-gray-800"
                                    th:text="${wish.item.itemName}">상품명</h5>
                                <p class="card-text">
                                    <strong class="text-danger text-base"
                                            th:text="${#numbers.formatInteger(wish.item.itemSaleprice, 0, 'COMMA') + '원'}">0원</strong>
                                </p>
                            </div>
                        </a>
                    </div>
                </div>
            </div>
        </section>

    </div>
</div>

<script layout:fragment="script">
    // 1. 게시글 불러오기
    function loadPosts(page) {
        fetch(`/mypage/ajax/posts?page=${page}`)
            .then(response => response.text()) // HTML 텍스트로 받음
            .then(html => {
                // 해당 컨테이너 내용을 서버에서 받은 HTML로 교체
                document.getElementById('post-list-container').innerHTML = html;
            })
            .catch(err => console.error("게시글 로드 실패:", err));
    }

    // 2. 댓글 불러오기
    function loadComments(page) {
        fetch(`/mypage/ajax/comments?page=${page}`)
            .then(response => response.text())
            .then(html => {
                document.getElementById('comment-list-container').innerHTML = html;
            })
            .catch(err => console.error("댓글 로드 실패:", err));
    }

    // 3. 좋아요 불러오기
    function loadLiked(page) {
        fetch(`/mypage/ajax/liked?page=${page}`)
            .then(response => response.text())
            .then(html => {
                document.getElementById('liked-list-container').innerHTML = html;
            })
            .catch(err => console.error("좋아요 로드 실패:", err));
    }
</script>
</body>
</html>