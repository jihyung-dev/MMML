<!doctype html>
<html lang="ko"
      xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{layouts/default_layout}">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1"/>
    <title>Hotdeal</title>

    <!-- Bootstrap CDN -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet"/>

    <!-- ํ๋ก์ํธ ๋ด๋ถ CSS -->
    <link th:href="@{/css/list.css}" rel="stylesheet"/>

    <link href="https://fonts.googleapis.com/css2?family=Manrope:wght@400;500;700;800&display=swap" rel="stylesheet">

    <style layout:fragment="css">
        .menu-link:hover {
            color: black;
            text-decoration: underline;
        }
    </style>

</head>
<body>

<div layout:fragment="content">

    <!-- ๐น ํ๋งค์ ๋ฑ๋ก / ํ๋งค์ ์์ธ / ๋ก๊ทธ์ธ ํ ์๋ ๋ฒํผ -->
    <div class="d-flex justify-content-end mb-3">

        <!-- 1) ๋น๋ก๊ทธ์ธ: ๋ก๊ทธ์ธ ํ์ด์ง๋ก ์๋ -->
        <a th:if="${session.loginUser == null}"
           th:href="@{/login}"
           class="btn btn-outline-secondary btn-sm">
            ๋ก๊ทธ์ธ ํ ํ๋งค์ ๋ฑ๋ก
        </a>

        <!-- 2) ๋ก๊ทธ์ธ ํ๊ณ, ์์ง ํ๋งค์๊ฐ ์๋ ๊ฒฝ์ฐ: ํ๋งค์ ๋ฑ๋ก -->
        <a th:if="${session.loginUser != null and (session.isSeller == null or session.isSeller == false)}"
           th:href="@{/seller/join}"
           class="btn btn-outline-primary btn-sm">
            ํ๋งค์ ๋ฑ๋ก
        </a>

        <!-- 3) ๋ก๊ทธ์ธ ํ๊ณ, ์ด๋ฏธ ํ๋งค์์ธ ๊ฒฝ์ฐ: ํ๋งค์ ์์ธ -->
        <a th:if="${session.loginUser != null and session.isSeller == true}"
           th:href="@{/seller}"
           class="btn btn-outline-primary btn-sm">
            ํ๋งค์ ์์ธ
        </a>
    </div>

    <!-- ์๋ฌ(๋๋กญ๋ค์ด) -->
    <div class="dropdown d-flex justify-content-end">
        <button class="btn btn-light btn-sm dropdown-toggle" type="button" id="sortDropdown"
                data-bs-toggle="dropdown" aria-expanded="false">
            ์๋ฌ: <span th:text="${currentSortLabel != null ? currentSortLabel : '์ต์์'}">์ต์์</span>
        </button>
        <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="sortDropdown">
            <li><a class="dropdown-item" th:href="@{'?'(page=0,sort='createdAt,desc')}">์ต์์</a></li>
            <li><a class="dropdown-item" th:href="@{'?'(page=0,sort='itemSaleprice,asc')}">๋ฎ์ ๊ฐ๊ฒฉ</a></li>
            <li><a class="dropdown-item" th:href="@{'?'(page=0,sort='itemSaleprice,desc')}">๋์ ๊ฐ๊ฒฉ</a></li>
        </ul>
    </div>

    <!-- ๋ฑ๋ก๋ ์ํ ์์ฒด ๊ฐฏ์ -->
    <div class="d-flex justify-content-end py-2">
        <small th:text="'์ด ' + ${itemPage.totalElements} + '๊ฐ'">์ด 0๊ฐ</small>
    </div>

    <!-- ์ํ ์นด๋ ๋ฆฌ์คํธ -->
    <div class="row g-3">
        <div class="col-12 col-sm-6 col-md-4 col-lg-3" th:each="item : ${itemPage.content}">
            <div class="card h-100">
                <a th:href="@{/hotdeal/{id}(id=${item.id})}" style="text-decoration:none;color:inherit;">
                    <!-- ์ด๋ฏธ์ง -->
                    <img th:src="${item.itemImageUrl != null ? item.itemImageUrl : '/img/no-image.png'}"
                         class="card-img-top"
                         alt="thumb"
                         onerror="this.src='/img/no-image.png'"/>
                    <div class="card-body d-flex flex-column">
                        <h5 class="card-title" th:text="${item.itemName}">์ํ๋ช</h5>
                        <p class="card-text mt-auto">
                            <strong th:text="${item.formattedPrice}">0์</strong>
                        </p>
                        <div class="text-muted small">
                            ์กฐํ์: <span th:text="${item.viewCount}">0</span>
                            &nbsp;ยท&nbsp; ์ธ๊ธฐ๋: <span th:text="${item.popularityScore}">0</span>
                        </div>
                    </div>
                </a>
            </div>
        </div>
    </div>

    <!-- ํ์ด์ง๋ค์ด์ -->
    <div th:with="page=${itemPage.number}, last=${itemPage.totalPages}, sort=${itemPage.sort}, size=${param.size}"
         class="my-4 d-flex justify-content-center">
        <nav>
            <ul class="pagination">
                <li class="page-item" th:classappend="(${itemPage}==0 ? 'disabled')">
                    <a class="page-link" th:href="@{'?'(page=0, size=${size})}">โช</a>
                </li>
                <li class="page-item" th:each="i : ${#numbers.sequence(1, last)}"
                    th:classappend="((${i}-1) == ${page}?'active')">
                    <a class="page-link" th:href="@{'?'(page=${i}-1, size=${size})}" th:text="${i}"></a>
                </li>
                <li class="page-item" th:classappend="(${page} == (${last}-1) ? 'disabled')">
                    <a class="page-link" th:href="@{'?'(page=${last}-1, size=${size})}">โซ</a>
                </li>
            </ul>
        </nav>
    </div>

</div>

<script layout:fragment="script">
    // ์ถ๊ฐ ์คํฌ๋ฆฝํธ ํ์ ์ ์ฌ๊ธฐ ์์ฑ
</script>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
