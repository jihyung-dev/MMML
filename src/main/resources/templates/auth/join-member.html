<!DOCTYPE html>
<html  lang="ko"
       xmlns:th="http://www.thymeleaf.org"
       xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
       layout:decorate="~{layouts/default_layout}"
       th:with="IS_LOGIN=false,CONTENT_TITLE='ë¡œê·¸ì¸ | ë‚´ëˆë‚´ì‚¶'">
<!-- ìœ„ì— ë‚´ìš© ì¤‘ IS_LOGIN=false ëŠ” ë¡œê·¸ì¸ ì—†ëŠ” ë©”ì¸í™”ë©´ ìƒë‹¨ , IS_LOGIN=false, ë¬¸êµ¬ ì „ì²´ì‚­ì œ ë¡œê·¸ì¸ ìˆëŠ” ë©”ì¸í™”ë©´ ìƒë‹¨ -->

<head>
    <meta charset="UTF-8">
    <title>íšŒì›ê°€ì…</title>
    <link rel="stylesheet" th:href="@{/css/login.css}">
    <script src="/js/login/login.js"></script>
    <style>
        /* ì „ì²´ íšŒì›ê°€ì… ë°•ìŠ¤ ê¸°ë³¸ í°íŠ¸ & í¬ê¸° */
        .login-container {
            font-family: 'Manrope', system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            font-size: 0.95rem;   /* ì „ì²´ ê¸€ì ì‚´ì§ ì¤„ì´ê¸° */
        }

        /* ì œëª©(íšŒì›ê°€ì…) */
        .login-container h2 {
            font-weight: 800;
            font-size: 1.4rem;
            letter-spacing: 0.02em;
        }

        /* ğŸ‘‰ ë©”ì¸ ë¼ë²¨(ì•„ì´ë””, ë¹„ë°€ë²ˆí˜¸, ì´ë¦„, ë‹‰ë„¤ì„, íœ´ëŒ€í°ë²ˆí˜¸, ì£¼ì†Œ, ì´ë©”ì¼, ì„±ë³„, ë‚˜ì´) êµµê²Œ */
        .login-container label {
            display: block;
            margin-top: 6px;
            margin-bottom: 2px;
            font-weight: 700;   /* êµµê²Œ */
            font-size: 0.9rem;
        }

        /* ì…ë ¥ì°½/ì…€ë ‰íŠ¸/ë²„íŠ¼ì€ ì‚´ì§ ì‘ì€ í°íŠ¸ */
        .login-container input,
        .login-container select,
        .login-container button {
            font-size: 0.9rem;
        }

        /* ì—ëŸ¬/ì•ˆë‚´ ë¬¸êµ¬ëŠ” ê¸°ì¡´ ìŠ¤íƒ€ì¼ ìœ ì§€ (ìˆìœ¼ë©´) */
        .field-msg {
            display: block;
            min-height: 1.2rem;
            margin-bottom: 4px;
        }
        .login-container .error-text {
            font-size: 0.8rem;
        }

    </style>


</head>


<!-- ğŸ”¹ ë¡œê·¸ì¸ ì»¨í…ì¸ : í™”ë©´ ì¤‘ì•™ ì •ë ¬ -->
<main layout:fragment="content"
      class="container d-flex justify-content-center align-items-center"
      style="min-height: 70vh;">

    <div class="login-container">
        <h2>íšŒì›ê°€ì…</h2>

        <p th:if="${error}" class="error-text" th:text="${error}"></p>

        <form th:action="@{/join/member}"
              method="post"
              th:object="${member}"
              id="joinForm">

            <label>ì•„ì´ë””</label>
            <input type="text"
                   th:field="*{memberId}"
                   id="memberId"
                   placeholder="ì•„ì´ë””"
                   required>
            <div id="memberIdMsg" class="field-msg error-text"></div>

            <label>ë¹„ë°€ë²ˆí˜¸</label>
            <input type="password" th:field="*{password}" placeholder="ë¹„ë°€ë²ˆí˜¸" required>

            <label>ì´ë¦„</label>
            <input type="text" th:field="*{memberName}" placeholder="ì´ë¦„" required>

            <label>ë‹‰ë„¤ì„</label>
            <input type="text"
                   th:field="*{memberNickname}"
                   id="nickname"
                   placeholder="ë‹‰ë„¤ì„"
                   required>
            <div id="nicknameMsg" class="field-msg error-text"></div>


            <label>íœ´ëŒ€í°ë²ˆí˜¸</label>
            <input type="text"
                   th:field="*{phone}"
                   id="phone"
                   placeholder="ìˆ«ìë§Œ 11ìë¦¬( - ì—†ì´) ì…ë ¥"
                   required
                   maxlength="11">

            <!-- ğŸ”¹ ì´ divì— ì—ëŸ¬/ì•ˆë‚´ ë¬¸êµ¬ë¥¼ í‘œì‹œ -->
            <div id="phoneMsg" class="field-msg error-text"></div>

            <label>ì£¼ì†Œ</label>
            <input type="text" th:field="*{address}" placeholder="ì£¼ì†Œë¥¼ ì…ë ¥í•˜ì„¸ìš”" required>

            <!-- ğŸ”¹ ì´ë©”ì¼ (ì¸ì¦ í•„ìˆ˜) -->
            <label>ì´ë©”ì¼</label>
            <input type="email" th:field="*{email}" id="emailInput" placeholder="ì´ë©”ì¼ì„ ì…ë ¥í•˜ì„¸ìš”" required>

            <!-- ì´ë©”ì¼ ì¸ì¦ ì—¬ë¶€ ì €ì¥ -->
            <input type="hidden" id="isEmailVerified" name="isEmailVerified" value="false">

            <!-- ì¸ì¦ë²ˆí˜¸ ìš”ì²­ -->
            <button type="button" onclick="sendEmailAuth()">ì´ë©”ì¼ ì¸ì¦ë²ˆí˜¸ ìš”ì²­</button>

            <!-- ì¸ì¦ë²ˆí˜¸ ì…ë ¥ UI -->
            <div id="authCodeBox">
                <input type="text" id="authCodeInput" placeholder="ì¸ì¦ë²ˆí˜¸ ì…ë ¥">
                <button type="button" onclick="sendAuthMail()">ì¸ì¦í•˜ê¸°</button>
            </div>

            <!-- ì„±ë³„ -->
            <label>ì„±ë³„</label>
            <select th:field="*{gender}" required>
                <option value="">ì„ íƒ</option>
                <option value="M">ë‚¨ì</option>
                <option value="F">ì—¬ì</option>
                <option value="U">ì„ íƒì•ˆí•¨</option>
            </select>

            <!-- ğŸ”¹ ë‚˜ì´ (ì„ íƒê°’, ì •ìˆ˜) -->
            <label>ë‚˜ì´</label>
            <input type="number" th:field="*{age}" min="0" max="120" placeholder="ë‚˜ì´" required>

            <button type="submit">ê°€ì…í•˜ê¸°</button>
        </form>

        <div class="login-links">
            <a th:href="@{/login}">ì´ë¯¸ ê³„ì •ì´ ìˆìœ¼ì‹ ê°€ìš”? ë¡œê·¸ì¸</a>
        </div>
    </div>
    <script>
        document.addEventListener('DOMContentLoaded', function () {
            const memberIdInput = document.getElementById('memberId');
            const nicknameInput = document.getElementById('nickname');
            const memberIdMsg   = document.getElementById('memberIdMsg');
            const nicknameMsg   = document.getElementById('nicknameMsg');

            // ì•„ì´ë”” ì…ë ¥ í›„ í¬ì»¤ìŠ¤ ë¹ ì§ˆ ë•Œ
            memberIdInput.addEventListener('blur', async function () {
                const value = memberIdInput.value.trim();
                if (!value) {
                    memberIdMsg.textContent = '';
                    return;
                }

                try {
                    const res = await fetch('/api/members/check-id?memberId=' + encodeURIComponent(value));
                    if (!res.ok) {
                        memberIdMsg.textContent = 'ì•„ì´ë”” í™•ì¸ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.';
                        return;
                    }
                    const data = await res.json();
                    memberIdMsg.textContent = data.duplicate
                        ? 'ì´ë¯¸ ì‚¬ìš© ì¤‘ì¸ ì•„ì´ë””ì…ë‹ˆë‹¤.'
                        : 'ì‚¬ìš© ê°€ëŠ¥í•œ ì•„ì´ë””ì…ë‹ˆë‹¤. ğŸ˜Š';
                } catch (e) {
                    console.error(e);
                    memberIdMsg.textContent = 'ì•„ì´ë”” í™•ì¸ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.';
                }
            });

            // ë‹‰ë„¤ì„ ì…ë ¥ í›„ í¬ì»¤ìŠ¤ ë¹ ì§ˆ ë•Œ
            nicknameInput.addEventListener('blur', async function () {
                const value = nicknameInput.value.trim();
                if (!value) {
                    nicknameMsg.textContent = '';
                    return;
                }

                try {
                    const res = await fetch('/api/members/check-nickname?nickname=' + encodeURIComponent(value));
                    if (!res.ok) {
                        nicknameMsg.textContent = 'ë‹‰ë„¤ì„ í™•ì¸ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.';
                        return;
                    }
                    const data = await res.json();
                    nicknameMsg.textContent = data.duplicate
                        ? 'ì´ë¯¸ ì‚¬ìš© ì¤‘ì¸ ë‹‰ë„¤ì„ì…ë‹ˆë‹¤.'
                        : 'ì‚¬ìš© ê°€ëŠ¥í•œ ë‹‰ë„¤ì„ì…ë‹ˆë‹¤. ğŸ˜„';
                } catch (e) {
                    console.error(e);
                    nicknameMsg.textContent = 'ë‹‰ë„¤ì„ í™•ì¸ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.';
                }
            });
        });
    </script>

    <script>
        document.addEventListener('DOMContentLoaded', function () {
            const phoneInput = document.getElementById('phone');
            const phoneMsg   = document.getElementById('phoneMsg');

            if (!phoneInput) return;

            phoneInput.addEventListener('blur', function () {
                const v = phoneInput.value.trim();

                if (!v) {
                    phoneMsg.textContent = '';
                    return;
                }

                const onlyDigits = /^\d{11}$/.test(v);
                if (!onlyDigits) {
                    phoneMsg.textContent = 'íœ´ëŒ€ì „í™” 11ìë¦¬ë¥¼ ì •í™•íˆ ì…ë ¥í•´ì£¼ì„¸ìš”';
                } else {
                    phoneMsg.textContent = ''; // or 'ì‚¬ìš© ê°€ëŠ¥í•œ ë²ˆí˜¸ í˜•ì‹ì…ë‹ˆë‹¤.' ë¼ê³  í•´ë„ ë¨
                }
            });
        });
    </script>



</main>
</html>













